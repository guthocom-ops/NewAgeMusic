<!doctype html>
<html>
<head>
    <title>Minha R√°dio Autom√°tica</title>
    <style>
        body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:20px; text-align:center; }
        #playerContainer { display:inline-block; background:#222; padding:20px; border-radius:15px; box-shadow:0 0 20px #000; max-width:400px; width:90%; }
        h2 { margin:0 0 10px 0; font-size:1.5em; }
        #cover { width:100%; max-width:200px; height:200px; margin:10px auto; border-radius:10px; background:#333; background-size:cover; background-position:center; }
        #trackTitle { margin-top:10px; font-weight:bold; font-size:1em; word-break:break-word; }
        #progressContainer { width:90%; height:12px; background:#555; margin:10px auto; border-radius:6px; overflow:hidden; }
        #progressBar { width:0%; height:100%; background:#4CAF50; transition:width 0.1s linear; }
        #nextTrack { margin-top:5px; font-size:0.85em; color:#aaa; word-break:break-word; }
        #controls button {
            padding:10px 16px; font-size:1em; border:none; border-radius:10px;
            background:#4CAF50; color:white; cursor:pointer; margin:10px 5px;
        }
        #controls button:hover { background:#45a049; }
        
        @media (max-width:500px){
            #cover { height:150px; }
            #trackTitle { font-size:0.9em; }
            #controls button { padding:8px 14px; font-size:0.9em; }
            #progressContainer { height:8px; }
        }
    </style>
</head>
<body>

<h2>üé∂ Minha R√°dio Autom√°tica</h2>
<div id="playerContainer">
    <div id="cover"></div>
    <div id="trackTitle">Aguardando...</div>
    <div id="progressContainer">
        <div id="progressBar"></div>
    </div>
    <div id="nextTrack">Pr√≥xima: ...</div>
    <div id="controls">
        <button id="playBtn">‚ñ∂Ô∏è Play</button>
    </div>
</div>

<audio id="player1" preload="auto"></audio>
<audio id="player2" preload="auto"></audio>

<script>
    // ================= CONFIGURA√á√ÉO ===================
    const playlistMusicas = [
        {url:"Amethystium-Ethereal.mp3", title:"M√∫sica 1", cover:"URL_CAPA_1"},
        {url:"Amethystium-Ethereal.mp3", title:"M√∫sica 2", cover:"URL_CAPA_2"},
        {url:"Amethystium-Ethereal.mp3", title:"M√∫sica 3", cover:"URL_CAPA_3"}
    ];
    const playlistVinhetas = [
        {url:"VH-1.mp3", title:"Vinheta 1", cover:""},
        {url:"VH-1.mp3", title:"Vinheta 2", cover:""}
    ];
    const modoAleatorio = true;
    const crossfadeTime = 8;
    // ===================================================

    let indexMusica = 0;
    let indexVinheta = 0;
    let tocandoMusica = true;

    const player1 = document.getElementById("player1");
    const player2 = document.getElementById("player2");
    const playBtn = document.getElementById("playBtn");
    const trackTitle = document.getElementById("trackTitle");
    const cover = document.getElementById("cover");
    const progressBar = document.getElementById("progressBar");
    const nextTrackDiv = document.getElementById("nextTrack");

    let currentPlayer = player1;
    let nextPlayer = player2;
    let isPlaying = false;

    let context, source1, source2, gain1, gain2;

    async function initAudioContext() {
        context = new (window.AudioContext || window.webkitAudioContext)();

        source1 = context.createMediaElementSource(player1);
        gain1 = context.createGain();
        source1.connect(gain1).connect(context.destination);

        source2 = context.createMediaElementSource(player2);
        gain2 = context.createGain();
        source2.connect(gain2).connect(context.destination);

        gain1.gain.value = 1;
        gain2.gain.value = 0;
    }

    function getNextTrack() {
        let faixa;
        if (tocandoMusica) {
            if (modoAleatorio) indexMusica = Math.floor(Math.random() * playlistMusicas.length);
            faixa = playlistMusicas[indexMusica % playlistMusicas.length];
            indexMusica++;
        } else {
            if (modoAleatorio) indexVinheta = Math.floor(Math.random() * playlistVinhetas.length);
            faixa = playlistVinhetas[indexVinheta % playlistVinhetas.length];
            indexVinheta++;
        }
        tocandoMusica = !tocandoMusica;
        return faixa;
    }

    function playNextTrack() {
        const faixa = getNextTrack();
        nextPlayer.src = faixa.url;
        trackTitle.textContent = faixa.title;
        cover.style.backgroundImage = faixa.cover ? `url(${faixa.cover})` : "none";

        let proximaFaixa = tocandoMusica ? playlistMusicas[indexMusica % playlistMusicas.length].title :
                                         playlistVinhetas[indexVinheta % playlistVinhetas.length].title;
        nextTrackDiv.textContent = "Pr√≥xima: " + proximaFaixa;

        nextPlayer.play();
    }

    function checkCrossfade() {
        if (!currentPlayer.duration) return;
        if (currentPlayer.currentTime >= currentPlayer.duration - crossfadeTime) {
            const now = context.currentTime;
            const currentGain = currentPlayer === player1 ? gain1 : gain2;
            const nextGain = nextPlayer === player1 ? gain1 : gain2;

            currentGain.gain.cancelScheduledValues(now);
            nextGain.gain.cancelScheduledValues(now);

            currentGain.gain.setValueAtTime(currentGain.gain.value, now);
            currentGain.gain.linearRampToValueAtTime(0, now + crossfadeTime);

            nextGain.gain.setValueAtTime(nextGain.gain.value, now);
            nextGain.gain.linearRampToValueAtTime(1, now + crossfadeTime);

            let temp = currentPlayer;
            currentPlayer = nextPlayer;
            nextPlayer = temp;

            playNextTrack();
        }
    }

    function update() {
        checkCrossfade();
        if(currentPlayer.duration) {
            progressBar.style.width = ((currentPlayer.currentTime/currentPlayer.duration)*100) + "%";
        }
    }

    playBtn.addEventListener("click", async () => {
        if (!isPlaying) {
            if (!context) await initAudioContext();
            else context.resume();
            
            playNextTrack();
            isPlaying = true;
            playBtn.textContent = "‚è∏Ô∏è Pause";
        } else {
            context.suspend();
            isPlaying = false;
            playBtn.textContent = "‚ñ∂Ô∏è Play";
        }
    });
</script>
</body>
</html>
